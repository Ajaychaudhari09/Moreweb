---
import Layout from "../../../layouts/Layout.astro";
import BlogCard from "../../../components/BlogCard";
import { getAllPosts, getPostsByCategory } from "../../../lib/posts";

export async function getStaticPaths() {
  const posts = await getAllPosts();
  const categories = [...new Set(posts.map((p) => p.category))];
  return categories.map((category) => ({
    params: { category },
    props: { category },
  }));
}

const { category } = Astro.props;
const posts = await getPostsByCategory(category);

const categoryLabel =
  category.charAt(0).toUpperCase() + category.slice(1).toLowerCase();
const title = `${categoryLabel} Articles | MoreFusion`;
const description = `Explore blog posts under the ${categoryLabel} category on MoreFusion.`;

const jsonLd = {
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  name: title,
  description: description,
  mainEntityOfPage: `https://morefusion.in/blog/${category}`,
  url: `https://morefusion.in/blog/${category}`,
};
---

<Layout title={title} description={description}>
  <script
    is:inline
    type="application/ld+json"
    set:html={JSON.stringify(jsonLd)}
  />

  <main class="min-h-screen bg-white dark:bg-gray-950">
    <section class="container mx-auto px-4 py-12 max-w-6xl">
      <header class="mb-8">
        <h1
          class="text-4xl md:text-5xl font-extrabold capitalize tracking-tight"
        >
          {categoryLabel}
        </h1>
        <p class="text-gray-600 dark:text-gray-400 mt-2 text-lg max-w-2xl">
          Explore curated articles related to {categoryLabel} from the MoreFusion
          blog.
        </p>
      </header>

      <section
        aria-label={`${categoryLabel} articles`}
        class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3"
      >
        {posts.map((p) => <BlogCard post={p} client:visible />)}
      </section>
    </section>
  </main>
</Layout>
